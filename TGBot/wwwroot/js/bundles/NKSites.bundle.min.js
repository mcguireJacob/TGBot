var NKObject=function(){},NK=new NKObject,NKAjaxCall;NK.Modals={serverModal:(n,t,i,r)=>{var u=!1;$.ajax({url:n,type:"get",cache:!1}).done(function(n){$("#modalAddEdit").find(".modal-body").html(n);$("#modalAddEdit").find(".modal-header > h3").html(t);$("#modalSize").addClass(i);NK.Validation.addRequiredMarks();u=!0}).fail(function(n){var t="";try{t=JSON.parse(n.responseText)}catch(i){console.error("Unable to parse ajax error response as JSON",i.message);ErrorMessage.show("There was an error retrieving your data!: "+i.message);return}if(typeof t!="undefined"&&t.JsonResult){ErrorMessage.show(t.JsonResult);return}alert("There was an error retrieving your data!")}).always(function(n,t){t!=="error"&&($("#modalAddEdit").modal(),r&&r(u))})},serverModalMd:(n,t,i)=>NK.Modals.serverModal(n,t,"modal-md",i),serverModalSm:(n,t,i)=>NK.Modals.serverModal(n,t,"modal-sm",i),serverModalLg:(n,t,i)=>NK.Modals.serverModal(n,t,"modal-lg",i),localModal:function(n,t){$(n).modal();t&&t()},alert:function(n,t,i){var r=$("#errormessage").find('[type="button"]');if(i)$(r).on("click",function(){$("#errormessage").modal("hide");setTimeout(i,410)});else $(r).off("click");$("#errormessageTitle").html(t||"Error:");$("#errormessageContent").html(n||"");$("#errormessage").modal()},confirm:function(n,t,i){$.confirm({animation:"top",title:t,content:n,buttons:{confirm:{btnClass:"btn-primary",action:function(){i(!0)}},cancel:{btnClass:"btn-secondary",action:function(){i(!1)}}}})}};NKAjaxCall=function(n){this.endPoint=null;this.method=null;this.parameters={};this.data=[];this._origTxt=null;this._origPosition=null;this._origHeight=null;this._origWidth=null;this.events={onBeforeSend:null,onAfterSend:null,onResultReceived:null,onUnexpectedResult:null,onSuccess:null,onFail:null,always:null};n&&this.setObj(n)};NKAjaxCall.prototype.setObj=function(n){for(var t in n)this.set(t,n[t])};NKAjaxCall.prototype.set=function(n,t){return this.hasOwnProperty(n)&&(this[n]=t),this};NKAjaxCall.prototype.get=function(n){return this[n]};NKAjaxCall.prototype.parseFail=function(n,t){var r,u,i;if(n.status==401||n.status==503){document.location="/login/?returnUrl="+document.location;return}if(n.status==404){Swal.fire("Error!","Endpoint not found","error");console.error("Endpoint not found",n);return}(r=!!n.responseJSON,u=!!n.responseText&&n.responseText!=""&&!r,r||u)&&(t?t(n):(i="",r&&n.responseJSON.JsonResult?i=n.responseJSON.JsonResult:u&&n.responseText?i=n.responseText:console.error("Ajax Failed!",n),i.trim().length>0&&Swal.fire("Error!",i,"error")))};NKAjaxCall.prototype.send=function(){if(this.events.onBeforeSend)this.events.onBeforeSend(this);if($.ajax({url:this.endPoint,type:this.method,cache:!1,data:this.parameters}).done(n=>this.onSuccess(n)).fail(n=>this.parseFail(n,this.events.onFail)),this.events.onAfterSend)this.events.onAfterSend(this);return this};NKAjaxCall.prototype.onSuccess=function(n){if(this.data=n,this.events.onResultReceived)this.events.onResultReceived(this.data);if(this.events.onSuccess)this.events.onSuccess(this.data)};NKAjaxCall.prototype.spinner='<i style="position:relative;" class="fa fa-spinner fa-pulse fa-lg"><\/i>';NKAjaxCall.prototype.handleButton=function(n,t){t?(n.prop("disabled",!0),this.origTxt=n.html(),this._origHeight=n.height(),this._origWidth=n.width(),this._origPosition=n.css("position"),n.html(this.spinner),n.css("position","relative"),n.height(this._origHeight),n.width(this._origWidth),n.prop("disabled",!0)):(n.html(this.origTxt),n.css("position",this._origPosition),n.prop("disabled",null))};NK.Ajax={util:{getFormData:function(n){return $(n).serialize()},getFormDataWithFiles:function(n){var t=NKAjax.util.getFormData(n),i=$('input[type="file"]');throw"Not implemented";}},get:function(n,t){new NKAjaxCall({method:"GET",endPoint:n,events:{onSuccess:t}}).send()},post:function(n,t,i,r,u){new NKAjaxCall({method:"POST",parameters:t,endPoint:n,events:{onBeforeSend:()=>{u&&KTApp.block(u,{overlayColor:"#000000",state:"primary",message:"Loading..."})},onAfterSend:()=>{u&&KTApp.unblock(u)},onSuccess:i,onFail:r}}).send()},sendForm:function(n,t,i){NK.Ajax.post(n.attr("action"),NK.Ajax.util.getFormData(n),t,i)},sendFormWithSpinner:function(n,t,i,r){new NKAjaxCall({method:"POST",parameters:NK.Ajax.util.getFormData(n),endPoint:n.attr("action"),events:{onBeforeSend:()=>{t&&KTApp.block(t,{overlayColor:"#000000",state:"primary",message:"Loading..."})},onAfterSend:()=>{t&&KTApp.unblock(t)},onSuccess:i,onFail:r}}).send()}};NK.Events={PageLoad:{load:function(){String.prototype.replaceAll=function(n,t){var i=this;if(n){while(!i.indexOf(n)>-1)i=i.replace(n,t);return i}};NK.Events.PageLoad.loadJQuery();NK.Formatting.formatCurrencyInputs(!0);NK.Events.PageLoad.selectFirstVisibleInput();NK.Validation.checkMaxLength();NK.Formatting.bindNumericOnlyInputs();NK.Events.PageLoad.fadeInContent();NK.Validation.addRequiredMarks();NK.Validation.checkMaxLength()},loadJQuery:function(){(function(n){n.fn.unbindTablesorter=function(){return n(this).unbind("appendCache applyWidgetId applyWidgets sorton update updateCell").find("thead th").unbind("click mousedown").removeClass("header headerSortDown headerSortUp"),this};n.fn.bindTablesorter=function(){return n(this).unbindTablesorter().tablesorter(),this};n.fn.scrollIntoView=function(){var t=n(this).offset();return n("html, body").animate({scrollTop:t.top-50,scrollLeft:t.left-50},700,"swing"),this};n.fn.resetChildInputs=function(){var t=null;n(this).find(":input").each(function(i,r){if(t=n(r).get()[0],n(r).is(":checkbox")||n(r).is(":radio"))t.checked=t.defaultChecked;else if(n(r).is("select"))for(var u=0;u<t.length;u++)t.options[u].selected=t.options[u].defaultSelected;else t.value=t.defaultValue})};n.fn.serializeObject=function(){var i=n(this).serializeArray(),r={},t;if(i)for(t=0;t<i.length;t++)r[i[t].name]=i[t].value;return r};n.fn.unformatCurrency=function(t,i){var u,f,r;if(n(this).length<1)return n(this);for(t||(t=2),u="0.",f=0;f<t;f++)u+="0";return r=null,n(this).length==1?(r=n(this).val(),i?r.trim().length==0||n(this).val(numeral(r).format(u)):n(this).val(numeral(r).format(u))):n(this).each(function(){r=n(this).val();i?r.trim().length==0||n(this).val(numeral(r).format(u)):n(this).val(numeral(r).format(u))}),n(this)};n.fn.formatCurrency=function(t,i,r,u){var f,o,e;for(t||(t=2),f="0",(r&&r=="true"||r==!0)&&(f="$"+f),(i&&i=="true"||i==!0)&&(f+=",0"),f+=".",o=0;o<t;o++)f+="0";return e=null,n(this).length==1?(e=n(this).val(),u?e.trim().length==0||n(this).val(numeral(e).format(f)):n(this).val(numeral(e).format(f))):n(this).each(function(){e=n(this).val();u?e.trim().length==0||n(this).val(numeral(e).format(f)):n(this).val(numeral(e).format(f))}),n(this)}})(jQuery)},selectFirstVisibleInput:function(n){var n=n;setTimeout(()=>{var t='input:not(.datepicker):not([datepicker]):not(button):not([type="checkbox"]):not([type="password"]):not([type="radio"]):visible';n?n.find(t).first().focus():$(t).first().focus()},400)},fadeInContent:function(){$("#kt_content").fadeIn(400)}}};NK.Formatting={formatCurrencyInputs:function(n){var t=n;setTimeout(()=>{$("[currency]").each(function(){for(var i,r,f=$(this).attr("currency"),n=f.split(","),e=3-n.length,u=0;u<e;u++)n.push[!1];i=i=>{$(i.target).formatCurrency(n[0].trim(),n[1].trim(),n[2].trim(),t)};r=i=>{$(i.target).unformatCurrency(n[0].trim(),t)};$(this).off("blur",i).on("blur",i).off("focus",r).on("focus",r);$(this).trigger("blur")})},60)},numericInputMasker:{keyPressHandler:function(n){var r=this,o=$(r).attr("wholePrecision"),e=$(r).attr("decimalPrecision"),t=n.which?n.which:event.keyCode,i=r.value.split("."),f,u;return(t<48||t>57)&&e===0?!1:t!==46&&(t<48||t>57)?!1:(f=numericInputMasker.getSelectionStart(r),u=r.value.indexOf("."),i[0]&&i[0].length>=o&&t!==46&&i[1]===undefined)?!1:i[1]&&(i[1].length>=e&&f>u||f>u&&u>-1&&i[1].length>1)?!1:!0},getSelectionStart:function(n){if(n.createTextRange){var t=document.selection.createRange().duplicate();return(t.moveEnd("character",n.value.length),t.text==="")?n.value.length:n.value.lastIndexOf(t.text)}return n.selectionStart}},bindNumericOnlyInputs:function(){var n=function(n){var t=$(n.target),i=t.get()[0],u=i.selectionStart,n=i.selectionEnd,f=t.val(),r=numeral(f).value();r!=null?(r=r.toString().replace("-",""),t.val(r)):t.val("");i.selectionStart=u;i.selectionEnd=n},t=$("[numericonly]");t.off("input",n).on("input",n)}};NK.Keyboard={numbersOnlyInput:function(){var n=evt?evt:window.event,t=n.which?n.which:n.keyCode;return t>31&&(t<48||t>57)?!1:!0}};NK.Timer=function(n,t){this.timer=null;this.interval=n;this.start=function(n){this.args=n;this._startTimer()};this._startTimer=function(){this.timer=setInterval(function(){this.eventHandler&&this.eventHandler(this.args)}.bind(this),this.interval)};this.stop=function(){clearInterval(this.timer)};this.reset=function(n,t,i){this.stop();n&&(this.interval=n);t&&(this.args=t);i&&(this.eventHandler=i);this._startTimer()};this.eventHandler=t;this.args=null};NK.Validation={validateSingle:function(n,t,i){var r=$("#"+n),u;if(!$(r).length){u="No ID Sent To Validate";console.error(u);throw u;}$(r).parsley().isValid()?i(t):$(r).parsley().validate()},addRequiredMarks:function(){var f=$("[required]"),r,n,t,i,u,e;for(r in f){if(n=null,t=f[r],r==="length")break;i=$(t).parent(".input-group");i&&i.length>0?n=i.siblings("label"):(n=$(t).prev("label"),n||(n=$(t).after("label")));n&&(u=$(n).find(".requiredMark"),e=$(u).length&&$(u).length>0,e||$(n).append('<span class="requiredMark" title="A value is required">&nbsp;*<\/span>'))}},cleanRequiredMarks:function(){$(".requiredMark").remove();NK.Validation.addRequiredMarks()},checkMaxLength:function(){$("[maxlength]").on("keyup",function(n){$(this).val().length>=$(this).attr("maxlength")?($(this).addClass("border-warning"),$(this).val().length>$(this).attr("maxlength")&&$(n).preventDefault()):$(this).removeClass("border-warning")}).on("focusout",function(){$(this).removeClass("border-warning")})}};